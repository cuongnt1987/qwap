<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">
    <ui:component>

        <h:form role="form" enctype="multipart/form-data">
            <div class="row">
                <div class="col-lg-12">

                    <h:messages 
                        globalOnly="false" 
                        styleClass="messages" 
                        infoClass="alert alert-info" 
                        warnClass="alert alert-warning" 
                        errorClass="alert alert-danger"/>

                    <div class="row">
                        <div class="col-lg-6 col-md-12">

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <h:outputLabel for="title" value="Title"/>
                                        <h:inputText id="title" styleClass="form-control" 
                                                     value="#{productBean.current.title}"
                                                     required="true"
                                                     requiredMessage="Title is required">
                                            <f:ajax listener="#{productBean.onChangeTitle()}" render="slug"/>
                                        </h:inputText>
                                        <h:message for="title" 
                                                   styleClass="help-block" 
                                                   errorClass="text-danger"
                                                   infoClass="text-info"
                                                   warnClass="text-warning"/>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <h:outputLabel for="slug" value="Slug"/>
                                        <h:inputText id="slug" styleClass="form-control" 
                                                     value="#{productBean.current.slug}"
                                                     required="true"
                                                     requiredMessage="Slug is required"/>
                                        <h:message for="slug" 
                                                   styleClass="help-block" 
                                                   errorClass="text-danger"
                                                   infoClass="text-info"
                                                   warnClass="text-warning"/>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <h:outputLabel for="metaKeywords" value="Meta keywords"/>
                                <h:inputText id="metaKeywords" styleClass="form-control" 
                                             value="#{productBean.current.metaKeywords}"/>
                                <h:message for="metaKeywords" 
                                           styleClass="help-block" 
                                           errorClass="text-danger"
                                           infoClass="text-info"
                                           warnClass="text-warning"/>
                            </div>

                            <div class="form-group">
                                <h:outputLabel for="metaDescription" value="Meta Description"/>
                                <h:inputText id="metaDescription" styleClass="form-control" 
                                             value="#{productBean.current.metaDescription}"/>
                                <h:message for="metaDescription" 
                                           styleClass="help-block" 
                                           errorClass="text-danger"
                                           infoClass="text-info"
                                           warnClass="text-warning"/>
                            </div>

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="checkbox">
                                        <label>
                                            <h:selectBooleanCheckbox id="hot"
                                                                     value="#{productBean.current.hot}"/>
                                            Hot product
                                        </label>

                                        <h:message for="hot" 
                                                   styleClass="help-block" 
                                                   errorClass="text-danger"
                                                   infoClass="text-info"
                                                   warnClass="text-warning"/>
                                    </div>
                                </div>

                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <h:outputLabel for="priority" value="Priority"/>
                                        <h:inputText id="priority" styleClass="form-control" 
                                                     value="#{productBean.current.priority}"/>
                                        <h:message for="priority" 
                                                   styleClass="help-block" 
                                                   errorClass="text-danger"
                                                   infoClass="text-info"
                                                   warnClass="text-warning"/>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <h:outputLabel for="type" value="Type"/>
                                        <h:selectOneMenu id="type"
                                                         styleClass="form-control"
                                                         value="#{productBean.current.type}"
                                                         converter="enumConverter">
                                            <f:selectItems value="#{productBean.productTypeSelectItems}"/>
                                            <f:ajax render="category"/>
                                        </h:selectOneMenu>
                                        <h:message for="type" 
                                                   styleClass="help-block" 
                                                   errorClass="text-danger"
                                                   infoClass="text-info"
                                                   warnClass="text-warning"/>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="form-group">
                                        <h:outputLabel for="category" value="Category"/>
                                        <h:selectOneMenu id="category"
                                                         styleClass="form-control"
                                                         value="#{productBean.current.category}"
                                                         converter="productCategoryConverter">
                                            <f:selectItems value="#{productBean.productCategorySelectItems}"/>
                                        </h:selectOneMenu>
                                        <h:message for="category" 
                                                   styleClass="help-block" 
                                                   errorClass="text-danger"
                                                   infoClass="text-info"
                                                   warnClass="text-warning"/>
                                    </div>    
                                </div>
                            </div>

                            <div class="form-group">
                                <h:outputLabel for="productDesc" value="Product Desc"/>
                                <h:inputTextarea id="productDesc" styleClass="form-control tinymce" 
                                                 rows="12"
                                                 value="#{productBean.current.productDesc}"/>
                                <h:message for="productDesc" 
                                           styleClass="help-block" 
                                           errorClass="text-danger"
                                           infoClass="text-info"
                                           warnClass="text-warning"/>
                            </div>

                            <div class="form-group">
                                <h:outputLabel for="description" value="Description"/>
                                <h:inputTextarea id="description" styleClass="form-control" 
                                                 value="#{productBean.current.description}"/>
                                <h:message for="description" 
                                           styleClass="help-block" 
                                           errorClass="text-danger"
                                           infoClass="text-info"
                                           warnClass="text-warning"/>
                            </div>
                        </div>

                        <div class="col-lg-6 col-md-12">
                            <div class="form-group">
                                <h:outputLabel for="thumbFile" value="Thumbnail"/>
                                <div class="clearfix">
                                    <h:graphicImage url="${productBean.current.thumbnail.URL}" 
                                                    rendered="${not empty productBean.current.thumbnail.id}"
                                                    class="pull-left img-rounded" width="75px" height="75px" style="margin: 0px 10px 10px 0;"/>
                                    <h:inputFile id="thumbFile" value="#{productBean.current.thumbnail.part}"/>
                                    <h:message for="thumbFile" 
                                               styleClass="help-block" 
                                               errorClass="text-danger"
                                               infoClass="text-info"
                                               warnClass="text-warning"/>
                                </div>


                            </div>

                            <div class="form-group">
                                <h:outputLabel for="bgFile" value="Backgroud"/>
                                <div class="clearfix">
                                    <h:graphicImage url="${productBean.current.bgFile.URL}" 
                                                    rendered="${not empty productBean.current.bgFile.id}"
                                                    class="pull-left img-responsive" style="margin: 0px 10px 10px 0; max-height: 150px"/>
                                    <h:inputFile id="bgFile" value="#{productBean.current.bgFile.part}"/>
                                    <h:message for="bgFile" 
                                               styleClass="help-block" 
                                               errorClass="text-danger"
                                               infoClass="text-info"
                                               warnClass="text-warning"/>
                                </div>

                            </div>

                            <div class="form-group">
                                <h:outputLabel for="screenshotTable" value="Screenshort"/>
                                <h:panelGroup id="screenshotContainer">
                                    <h:dataTable
                                        id="screenshotTable"
                                        class="table table-striped table-hover" 
                                        
                                        value="#{productBean.screenShots}" 
                                        var="image">
                                        <h:column>
                                            <f:facet name="header">
                                                Image
                                            </f:facet>
                                            <img src="${image.URL}" 
                                                 class="img-responsive img-rounded" 
                                                 width="150" 
                                                 jsf:rendered="${not empty image.id}"/>
                                        </h:column>

                                        <h:column>
                                            <f:facet name="header">File</f:facet>
                                            <h:inputFile id="" value="#{image.part}" />
                                        </h:column>

                                        <h:column>
                                            <f:facet name="header">Check</f:facet>
                                            <h:selectBooleanCheckbox value="#{image.selected}">
                                                <f:ajax execute="@this" render="@this"/>
                                            </h:selectBooleanCheckbox>
                                        </h:column>
                                    </h:dataTable>
                                </h:panelGroup>

                                <div class="btn-toolbar">
                                    <div class="btn-group">
                                        <h:commandButton value="Add" class="btn btn-sm btn-success" actionListener="#{productBean.addScreenshort()}">
                                            <f:ajax execute="screenshotContainer" render="screenshotContainer"/>
                                        </h:commandButton>

                                        <h:commandButton value="Delete" class="btn btn-sm btn-danger" actionListener="#{productBean.removeScreenshort}">
                                            <f:ajax execute="screenshotContainer" render="screenshotContainer"/>
                                        </h:commandButton>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <h:outputLabel value="Application file"/>
                                <table class="table table-hover table-striped">
                                    <thead>
                                        <tr>
                                            <th>File</th>
                                            <th>Os type</th>
                                            <th></th>
                                            <th>Link</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <c:forEach items="#{productBean.current.appFiles}"
                                                   var="appFile" varStatus="vs">
                                            <tr>
                                                <td>
                                                    <h:outputText value="${msg.none}" rendered="${appFile.id == null or (appFile.title == null and appFile.url == null)}"/>
                                                    <c:if test="${appFile.id != null and (appFile.title != null or appFile.url != null)}">
                                                        <a href="${appFile.downloadURL}">
                                                            <i class="fa fa-download fa-fw"></i>
                                                            ${appFile.title == null ? 'Download' : appFile.title}
                                                        </a>
                                                    </c:if>
                                                </td>
                                                <td>${msg[appFile.type]}</td>
                                                <td><h:inputFile value="#{appFile.part}"/></td>
                                                <td><h:inputText value="#{appFile.url}">
                                                        <f:passThroughAttribute name="type" value="url"/>
                                                    </h:inputText>
                                                </td>
                                            </tr>
                                        </c:forEach>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>


                    <div class="btn-toolbar">
                        <div class="btn-group">
                            <h:commandButton styleClass="btn btn-primary" 
                                             actionListener="#{productBean.persist()}" 
                                             rendered="#{empty param.id}"
                                             value="Save">
                                <f:ajax execute="@form" render="@all"/>
                            </h:commandButton>

                            <h:commandButton styleClass="btn btn-primary" 
                                             actionListener="#{productBean.update()}" 
                                             rendered="#{not empty param.id}"
                                             value="Update">
                                <f:ajax execute="@form" render="@all"/>
                            </h:commandButton>
                        </div>

                        <div class="btn-group">
                            <h:button styleClass="btn btn-default" 
                                      value="Back" 
                                      outcome="index"/>
                        </div>
                    </div>

                </div>
            </div>
        </h:form>
    </ui:component>
</html>

